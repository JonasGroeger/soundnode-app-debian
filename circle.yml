#######################
# Additional settings #
#######################
#
# 1. PACKAGECLOUD_TOKEN env var from https://packagecloud.io/docs#circle_ci
# 2.

machine:
  services:
    - docker

checkout:
  post:
    - git clone https://github.com/Soundnode/soundnode-app.git src

dependencies:
  pre:
    - gem install package_cloud
  override:
    - docker build --rm=false -t soundnode-app-build .

deployment:
  production:
    branch: master
    commands:
      - docker cp $(docker ps -aq --no-trunc | head -n1):/root/dist .
      - ./push-deb dist/
